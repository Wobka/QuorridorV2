#include <stdio.h>
#include <string.h>
#include "charger_score.h"

#define MAX_JOUEURS 2
#define TAILLE_NOM 50

typedef struct {
    char nom[TAILLE_NOM];
    int score;
} Joueur;


int main() {
    Joueur joueurs[MAX_JOUEURS];
    int nb_joueurs = 0;
    char fichier[] = "scores.txt";
    charger_scores(fichier, joueurs, &nb_joueurs);

    char nom_joueur1[TAILLE_NOM], nom_joueur2[TAILLE_NOM];
    int gagnant;
    char rejouer;

    printf("Bienvenue au gestionnaire de scores de jeu !\n");

    do {
        printf("\nEntrez le nom du joueur 1 : ");
        scanf("%s", nom_joueur1);
        printf("\nEntrez le nom du joueur 2 : ");
        scanf("%s", nom_joueur2);

        int indice1 = trouver_joueur(joueurs, nb_joueurs, nom_joueur1);
        if (indice1 == -1) {
            strcpy(joueurs[nb_joueurs].nom, nom_joueur1);
            joueurs[nb_joueurs].score = 0;
            indice1 = nb_joueurs++;
        }

        int indice2 = trouver_joueur(joueurs, nb_joueurs, nom_joueur2);
        if (indice2 == -1) {
            strcpy(joueurs[nb_joueurs].nom, nom_joueur2);
            joueurs[nb_joueurs].score = 0;
            indice2 = nb_joueurs++;
        }

        printf("Qui a gagne ? (1 pour %s, 2 pour %s, 0 pour aucun) : ", nom_joueur1, nom_joueur2);
        scanf("%d", &gagnant);

        if (gagnant == 1) {
            joueurs[indice1].score += 5;
        } else if (gagnant == 2) {
            joueurs[indice2].score += 5;
        }


        printf("\n-----Scores apres la partie :-----\n");
        printf("%s : %d points\n", joueurs[indice1].nom, joueurs[indice1].score);
        printf("%s : %d points\n", joueurs[indice2].nom, joueurs[indice2].score);

        sauvegarder_scores(fichier, joueurs, nb_joueurs);

        printf("\nVoulez-vous rejouer ? (o/n) : ");
        scanf(" %c", &rejouer);

    } while (rejouer == 'o' || rejouer == 'O');

    printf("\nMerci d'avoir joue ! Les scores finaux ont ete sauvegardes dans '%s'.\n", fichier);

    return 0;
}
